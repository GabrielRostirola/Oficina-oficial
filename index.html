<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oficina Mecânica do Abel</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --surface2: #1a1a26;
    --border: #2a2a3a;
    --accent: #e8a020;
    --accent2: #ff6b35;
    --text: #e8e8f0;
    --text-muted: #7a7a9a;
    --green: #2ecc71;
    --red: #e74c3c;
    --blue: #3498db;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:'Rajdhani',sans-serif; font-size:16px; overflow-x:hidden; }

  /* ---- LOGIN ---- */
  #login-screen {
    position: fixed;
    inset: 0;
    background: var(--bg);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    transition: 0.5s;
  }
  .login-card {
    background: var(--surface);
    padding: 40px;
    border: 1px solid var(--border);
    border-radius: 4px;
    width: 100%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    border-top: 4px solid var(--accent);
  }
  .login-card h1 {
    font-family: 'Bebas Neue';
    font-size: 48px;
    color: var(--accent);
    letter-spacing: 4px;
    margin-bottom: 10px;
  }
  .login-card input {
    width: 100%;
    padding: 15px;
    margin: 10px 0;
    background: var(--bg);
    border: 1px solid var(--border);
    color: white;
    font-family: 'Share Tech Mono';
    outline: none;
    font-size: 18px;
    text-align: center;
  }
  .login-card button {
    width: 100%;
    padding: 15px;
    background: var(--accent);
    border: none;
    color: #000;
    font-weight: 700;
    font-family: 'Bebas Neue';
    font-size: 20px;
    cursor: pointer;
    margin-top: 10px;
    transition: 0.3s;
    letter-spacing: 2px;
  }

  /* ---- APP LAYOUT ---- */
  header {
    background: var(--surface);
    padding: 20px 40px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .nav-tabs {
    display: flex;
    gap: 2px;
    padding: 0 40px;
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
  }
  .tab-btn {
    padding: 15px 30px;
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    font-family: 'Bebas Neue';
    font-size: 18px;
    letter-spacing: 1px;
    transition: 0.3s;
    position: relative;
  }
  .tab-btn:hover { color: var(--accent); }
  .tab-btn.active {
    color: var(--accent);
    background: var(--surface);
  }
  .tab-btn.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--accent);
  }

  .container { padding: 40px; max-width: 1400px; margin: 0 auto; }
  .hidden { display: none !important; }

  /* ---- CARDS & STATS ---- */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
  }
  .stat-box {
    background: var(--surface);
    padding: 30px;
    border: 1px solid var(--border);
    border-bottom: 4px solid var(--accent);
    position: relative;
  }
  .stat-box h3 {
    font-size: 14px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 10px;
  }
  .stat-box p {
    font-size: 36px;
    font-weight: 700;
    font-family: 'Share Tech Mono';
    color: var(--text);
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 25px;
    border-radius: 4px;
    margin-bottom: 25px;
    position: relative;
    overflow: hidden;
  }
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border);
  }

  /* ---- FORMS & TABLES ---- */
  .grid-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }
  input, select {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: white;
    padding: 12px 15px;
    border-radius: 4px;
    font-family: 'Rajdhani';
    font-size: 16px;
    outline: none;
  }
  input:focus { border-color: var(--accent); }

  table { width: 100%; border-collapse: collapse; margin: 20px 0; }
  th {
    text-align: left;
    padding: 15px;
    background: var(--surface2);
    color: var(--accent);
    font-family: 'Bebas Neue';
    letter-spacing: 1px;
    font-size: 16px;
  }
  td { padding: 15px; border-bottom: 1px solid #2a2a3a; }

  /* ---- BUTTONS ---- */
  .btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Bebas Neue';
    font-size: 16px;
    letter-spacing: 1px;
    transition: 0.3s;
    text-transform: uppercase;
  }
  .btn-green { background: var(--green); color: white; }
  .btn-red { background: var(--red); color: white; }
  .btn-blue { background: var(--blue); color: white; }
  .btn-orange { background: var(--accent); color: #000; }
  .btn:hover { opacity: 0.8; transform: translateY(-2px); }

  /* Estilos da Notinha para o Modal */
  .receipt-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    padding: 20px;
  }
  .receipt-paper {
    background: #fff;
    color: #000;
    width: 100%;
    max-width: 400px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    font-family: 'Courier New', Courier, monospace;
  }
</style>
</head>
<body>

<div id="login-screen">
  <div class="login-card">
    <h1>ABEL TRUCKS</h1>
    <p style="color:var(--text-muted); margin-bottom:25px; letter-spacing:2px;">SISTEMA DE GESTÃO AUTOMOTIVA</p>
    <input type="text" id="user" placeholder="USUÁRIO">
    <input type="password" id="pass" placeholder="SENHA">
    <button onclick="login()">ENTRAR NO SISTEMA</button>
  </div>
</div>

<div id="app" class="hidden">
  <header>
    <div style="display:flex; align-items:center; gap:20px;">
      <div style="width:40px; height:40px; background:var(--accent); display:flex; align-items:center; justify-content:center; color:#000; font-weight:900; font-size:24px; border-radius:4px;">A</div>
      <h2 style="font-family:'Bebas Neue'; font-size:28px; letter-spacing:2px;">OFICINA MECÂNICA DO ABEL</h2>
    </div>
    <div style="display:flex; gap:15px; align-items:center;">
      <span id="display-user" style="color:var(--text-muted); font-family:'Share Tech Mono';"></span>
      <button onclick="logout()" class="btn btn-red" style="font-family:'Bebas Neue'; padding:8px 20px; font-size:16px;">LOGOUT</button>
    </div>
  </header>

  <nav class="nav-tabs">
    <button class="tab-btn active" onclick="switchTab('dashboard')">DASHBOARD</button>
    <button class="tab-btn" onclick="switchTab('clientes')">CLIENTES & SERVIÇOS</button>
    <button class="tab-btn" onclick="switchTab('gastos')">CONTROLE DE GASTOS</button>
  </nav>

  <main class="container">
    <section id="tab-dashboard" class="tab-content">
      <div class="stats-grid">
        <div class="stat-box">
          <h3>Faturamento Bruto</h3>
          <p id="stat-faturamento" style="color:var(--green)">R$ 0,00</p>
        </div>
        <div class="stat-box" style="border-bottom-color: var(--red);">
          <h3>Total de Gastos</h3>
          <p id="stat-gastos" style="color:var(--red)">R$ 0,00</p>
        </div>
        <div class="stat-box" style="border-bottom-color: var(--blue);">
          <h3>Lucro Líquido</h3>
          <p id="stat-lucro" style="color:var(--blue)">R$ 0,00</p>
        </div>
      </div>
    </section>

    <section id="tab-clientes" class="tab-content hidden">
      <div class="card">
        <div class="card-header">
          <h3 style="font-family:'Bebas Neue'; letter-spacing:1px;">CADASTRAR NOVO CLIENTE / CAMINHÃO</h3>
        </div>
        <div class="grid-form">
          <input type="text" id="cli-nome" placeholder="NOME DO CLIENTE">
          <input type="text" id="cli-modelo" placeholder="MODELO DO CAMINHÃO">
          <input type="text" id="cli-placa" placeholder="PLACA" style="text-transform: uppercase;">
          <button onclick="addCliente()" class="btn btn-orange">CADASTRAR VEÍCULO</button>
        </div>
      </div>
      <div id="lista-clientes"></div>
    </section>

    <section id="tab-gastos" class="tab-content hidden">
      <div class="card">
        <div class="card-header">
          <h3 style="font-family:'Bebas Neue'; letter-spacing:1px;">REGISTRAR GASTO DA OFICINA</h3>
        </div>
        <div class="grid-form">
          <input type="text" id="gas-desc" placeholder="DESCRIÇÃO DO GASTO">
          <input type="number" id="gas-valor" placeholder="VALOR (R$)">
          <button onclick="addGasto()" class="btn btn-red">REGISTRAR GASTO</button>
        </div>
      </div>
      <div class="card">
        <table>
          <thead>
            <tr><th>DESCRIÇÃO</th><th>VALOR</th><th>AÇÃO</th></tr>
          </thead>
          <tbody id="corpo-gastos"></tbody>
        </table>
      </div>
    </section>
  </main>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCnvqGp4YFL8CuHwRNrQYF0Wz6hd-7Oih0",
    authDomain: "oficina-do-abel.firebaseapp.com",
    databaseURL: "https://oficina-do-abel-default-rtdb.firebaseio.com",
    projectId: "oficina-do-abel",
    storageBucket: "oficina-do-abel.firebasestorage.app",
    messagingSenderId: "894287955652",
    appId: "1:894287955652:web:8c9908fbc6d0e37611ab91"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const dbRef = ref(db, 'oficina_dados');

  window.dados = { clientes: [], servicos: [], pagamentos: [], gastos: [] };

  // Função para salvar que agora usa o Firebase
  function salvarDados() {
    set(dbRef, window.dados);
  }

  // Puxar dados da nuvem
  onValue(dbRef, (snapshot) => {
    const val = snapshot.val();
    if (val) {
      window.dados = val;
      renderizarTudo();
    }
  });

  // --- SUAS FUNÇÕES ORIGINAIS ---
  window.login = function() {
    const user = document.getElementById('user').value;
    const pass = document.getElementById('pass').value;
    if(user === "gabriel" && pass === "lovemall1") {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      document.getElementById('display-user').innerText = `OPERADOR: ${user.toUpperCase()}`;
    } else { alert("Acesso negado!"); }
  }

  window.logout = function() { location.reload(); }

  window.switchTab = function(tab) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + tab).classList.remove('hidden');
    event.currentTarget.classList.add('active');
  }

  window.addCliente = function() {
    const nome = document.getElementById('cli-nome').value;
    const modelo = document.getElementById('cli-modelo').value;
    const placa = document.getElementById('cli-placa').value.toUpperCase();
    if(nome && placa) {
      window.dados.clientes.push({ id: Date.now(), nome, modelo, placa, servicos: [], pago: 0 });
      salvarDados();
      document.getElementById('cli-nome').value = '';
      document.getElementById('cli-modelo').value = '';
      document.getElementById('cli-placa').value = '';
    }
  }

  window.removerCliente = function(id) {
    if(confirm("Excluir cliente?")) {
      window.dados.clientes = window.dados.clientes.filter(c => c.id !== id);
      salvarDados();
    }
  }

  window.addServico = function(cliId) {
    const desc = prompt("Descrição:");
    const valor = parseFloat(prompt("Valor:"));
    if(desc && !isNaN(valor)) {
      const cli = window.dados.clientes.find(c => c.id === cliId);
      if(!cli.servicos) cli.servicos = [];
      cli.servicos.push({ id: Date.now(), desc, valor });
      salvarDados();
    }
  }

  window.lancarPagamento = function(cliId) {
    const valor = parseFloat(prompt("Valor pago:"));
    if(!isNaN(valor)) {
      const cli = window.dados.clientes.find(c => c.id === cliId);
      cli.pago = (cli.pago || 0) + valor;
      salvarDados();
    }
  }

  window.addGasto = function() {
    const desc = document.getElementById('gas-desc').value;
    const valor = parseFloat(document.getElementById('gas-valor').value);
    if(desc && !isNaN(valor)) {
      if(!window.dados.gastos) window.dados.gastos = [];
      window.dados.gastos.push({ id: Date.now(), desc, valor });
      salvarDados();
      document.getElementById('gas-desc').value = '';
      document.getElementById('gas-valor').value = '';
    }
  }

  window.removerGasto = function(id) {
    window.dados.gastos = window.dados.gastos.filter(g => g.id !== id);
    salvarDados();
  }

  function renderizarTudo() {
    renderDashboard();
    renderClientes();
    renderGastos();
  }

  function renderDashboard() {
    let faturamento = 0;
    window.dados.clientes.forEach(c => {
      if(c.servicos) c.servicos.forEach(s => faturamento += s.valor);
    });
    const gastos = (window.dados.gastos || []).reduce((acc, g) => acc + g.valor, 0);
    document.getElementById('stat-faturamento').innerText = `R$ ${faturamento.toFixed(2)}`;
    document.getElementById('stat-gastos').innerText = `R$ ${gastos.toFixed(2)}`;
    document.getElementById('stat-lucro').innerText = `R$ ${(faturamento - gastos).toFixed(2)}`;
  }

  function renderClientes() {
    const container = document.getElementById('lista-clientes');
    container.innerHTML = '';
    window.dados.clientes.forEach(c => {
      let total = (c.servicos || []).reduce((acc, s) => acc + s.valor, 0);
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="card-header">
          <h4>${c.nome} - ${c.modelo} (${c.placa})</h4>
          <button onclick="removerCliente(${c.id})" class="btn btn-red">X</button>
        </div>
        <table>
          ${(c.servicos || []).map(s => `<tr><td>${s.desc}</td><td>R$ ${s.valor.toFixed(2)}</td></tr>`).join('')}
        </table>
        <div style="margin-top:15px; display:flex; gap:10px; justify-content:space-between; align-items:center;">
          <div>
            <button onclick="addServico(${c.id})" class="btn btn-blue">+ SERVIÇO</button>
            <button onclick="lancarPagamento(${c.id})" class="btn btn-green">PAGAR</button>
            <button onclick="imprimirNota(${c.id})" class="btn btn-orange">NOTA</button>
          </div>
          <div style="text-align:right">
            <p>Total: R$ ${total.toFixed(2)}</p>
            <p>Falta: R$ ${(total - (c.pago || 0)).toFixed(2)}</p>
          </div>
        </div>
      `;
      container.appendChild(card);
    });
  }

  function renderGastos() {
    const corpo = document.getElementById('corpo-gastos');
    corpo.innerHTML = '';
    (window.dados.gastos || []).forEach(g => {
      corpo.innerHTML += `<tr><td>${g.desc}</td><td>R$ ${g.valor.toFixed(2)}</td><td><button onclick="removerGasto(${g.id})" class="btn btn-red">X</button></td></tr>`;
    });
  }

  window.imprimirNota = function(id) {
    const c = window.dados.clientes.find(cli => cli.id === id);
    const total = (c.servicos || []).reduce((acc, s) => acc + s.valor, 0);
    const win = window.open('', '', 'width=600,height=800');
    win.document.write(`
      <html><body>
        <h1>ABEL TRUCKS</h1>
        <hr>
        <p>Cliente: ${c.nome}</p>
        <p>Veículo: ${c.modelo} (${c.placa})</p>
        <hr>
        ${(c.servicos || []).map(s => `<p>${s.desc}: R$ ${s.valor.toFixed(2)}</p>`).join('')}
        <hr>
        <h3>Total: R$ ${total.toFixed(2)}</h3>
      </body></html>
    `);
    win.print();
  }
</script>
</body>
</html>
