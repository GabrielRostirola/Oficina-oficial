<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oficina Mec√¢nica do Abel</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f; --surface: #12121a; --surface2: #1a1a26; --border: #2a2a3a;
    --accent: #e8a020; --accent2: #ff6b35; --text: #e8e8f0; --text-muted: #7a7a9a;
    --green: #2ecc71; --red: #e74c3c; --blue: #3498db;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:'Rajdhani',sans-serif; font-size:16px; overflow-x:hidden; }

  /* Login */
  #login-screen { position:fixed; inset:0; background:var(--bg); display:flex; align-items:center; justify-content:center; z-index:1000; }
  .login-card { background:var(--surface); padding:40px; border:1px solid var(--border); border-radius:4px; width:100%; max-width:400px; text-align:center; box-shadow:0 20px 50px rgba(0,0,0,0.5); }
  .login-card h1 { font-family:'Bebas Neue'; font-size:40px; color:var(--accent); letter-spacing:2px; margin-bottom:10px; }
  .login-card input { width:100%; padding:12px; margin:10px 0; background:var(--bg); border:1px solid var(--border); color:white; outline:none; }
  .login-card button { width:100%; padding:12px; background:var(--accent); border:none; color:#000; font-weight:700; cursor:pointer; margin-top:10px; }

  /* Dashboard */
  header { background:var(--surface); padding:20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
  .nav-tabs { display:flex; gap:10px; padding:20px; background:var(--surface2); }
  .tab-btn { padding:10px 20px; background:none; border:1px solid var(--border); color:var(--text-muted); cursor:pointer; font-weight:600; font-family:'Rajdhani'; }
  .tab-btn.active { background:var(--accent); color:#000; border-color:var(--accent); }
  
  .container { padding:20px; max-width:1200px; margin:0 auto; }
  .card { background:var(--surface); border:1px solid var(--border); padding:20px; border-radius:4px; margin-bottom:20px; }
  .stats-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-bottom:20px; }
  .stat-box { background:var(--surface2); padding:20px; border-left:4px solid var(--accent); }
  .stat-box h3 { font-size:14px; color:var(--text-muted); text-transform:uppercase; }
  .stat-box p { font-size:28px; font-weight:700; font-family:'Share Tech Mono'; }

  input, select { background:var(--surface2); border:1px solid var(--border); color:white; padding:10px; border-radius:4px; outline:none; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th { text-align:left; padding:12px; border-bottom:2px solid var(--border); color:var(--accent); }
  td { padding:12px; border-bottom:1px solid var(--border); }
  .btn { padding:8px 15px; border:none; border-radius:2px; cursor:pointer; font-weight:600; margin-right:5px; font-family:'Rajdhani'; transition: 0.3s; }
  .btn-green { background:var(--green); color:white; }
  .btn-red { background:var(--red); color:white; }
  .btn-blue { background:var(--blue); color:white; }
  .btn:hover { opacity: 0.8; }

  .hidden { display:none !important; }
</style>
</head>
<body>

<div id="login-screen">
  <div class="login-card">
    <h1>ABEL TRUCKS</h1>
    <p style="color:var(--text-muted); margin-bottom:20px; font-size:12px; letter-spacing:3px;">SISTEMA DE GEST√ÉO NUVEM</p>
    <input type="text" id="user" placeholder="USU√ÅRIO">
    <input type="password" id="pass" placeholder="SENHA">
    <button id="loginBtn">ACESSAR SISTEMA</button>
  </div>
</div>

<div id="app" class="hidden">
  <header>
    <h2 style="font-family:'Bebas Neue'; letter-spacing:2px; color:var(--accent)">OFICINA MEC√ÇNICA DO ABEL</h2>
    <button onclick="location.reload()" class="btn btn-red">SAIR</button>
  </header>

  <div class="nav-tabs">
    <button class="tab-btn active" onclick="switchTab('dashboard')">RESUMO FINANCEIRO</button>
    <button class="tab-btn" onclick="switchTab('clientes')">CLIENTES E SERVI√áOS</button>
    <button class="tab-btn" onclick="switchTab('gastos')">GASTOS DA OFICINA</button>
  </div>

  <div class="container">
    <div id="tab-dashboard" class="tab-content">
      <div class="stats-grid">
        <div class="stat-box"><h3>Faturamento Bruto</h3><p id="stat-faturamento" style="color:var(--green)">R$ 0,00</p></div>
        <div class="stat-box" style="border-color:var(--red)"><h3>Total de Gastos</h3><p id="stat-gastos" style="color:var(--red)">R$ 0,00</p></div>
        <div class="stat-box" style="border-color:var(--blue)"><h3>Lucro L√≠quido</h3><p id="stat-lucro" style="color:var(--blue)">R$ 0,00</p></div>
      </div>
    </div>

    <div id="tab-clientes" class="tab-content hidden">
      <div class="card">
        <h3>CADASTRAR CLIENTE / CAMINH√ÉO</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:10px; margin-top:15px;">
          <input type="text" id="cli-nome" placeholder="Nome do Cliente">
          <input type="text" id="cli-modelo" placeholder="Modelo do Caminh√£o">
          <input type="text" id="cli-placa" placeholder="Placa" style="text-transform: uppercase;">
          <button id="addCliBtn" class="btn btn-green">CADASTRAR</button>
        </div>
      </div>
      <div id="lista-clientes"></div>
    </div>

    <div id="tab-gastos" class="tab-content hidden">
      <div class="card">
        <h3>REGISTRAR GASTO</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-top:15px;">
          <input type="text" id="gas-desc" placeholder="Descri√ß√£o (Pe√ßas, Aluguel, etc)">
          <input type="number" id="gas-valor" placeholder="Valor R$">
          <button id="addGasBtn" class="btn btn-red">REGISTRAR GASTO</button>
        </div>
      </div>
      <div class="card">
        <table>
          <thead><tr><th>DESCRI√á√ÉO</th><th>VALOR</th><th>A√á√ÉO</th></tr></thead>
          <tbody id="corpo-gastos"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script type="module">
  // FIREBASE SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCnvqGp4YFL8CuHwRNrQYF0Wz6hd-7Oih0",
    authDomain: "oficina-do-abel.firebaseapp.com",
    databaseURL: "https://oficina-do-abel-default-rtdb.firebaseio.com",
    projectId: "oficina-do-abel",
    storageBucket: "oficina-do-abel.firebasestorage.app",
    messagingSenderId: "894287955652",
    appId: "1:894287955652:web:8c9908fbc6d0e37611ab91"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const dbRef = ref(db, 'dados_oficina');

  window.dados = { clientes: [], gastos: [] };

  // --- LOGIN ---
  document.getElementById('loginBtn').onclick = () => {
    const u = document.getElementById('user').value;
    const p = document.getElementById('pass').value;
    if(u === "gabriel" && p === "lovemall1") {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
    } else { alert("Acesso Negado!"); }
  };

  // --- NAVEGA√á√ÉO ---
  window.switchTab = (tab) => {
    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-'+tab).classList.remove('hidden');
    event.target.classList.add('active');
  };

  // --- SINCRONIZA√á√ÉO NUVEM ---
  function salvar() { set(dbRef, window.dados); }

  onValue(dbRef, (snapshot) => {
    const val = snapshot.val();
    if(val) {
      window.dados = val;
      if(!window.dados.clientes) window.dados.clientes = [];
      if(!window.dados.gastos) window.dados.gastos = [];
      renderizar();
    }
  });

  // --- CLIENTES ---
  document.getElementById('addCliBtn').onclick = () => {
    const nome = document.getElementById('cli-nome').value;
    const modelo = document.getElementById('cli-modelo').value;
    const placa = document.getElementById('cli-placa').value.toUpperCase();
    if(nome && placa) {
      window.dados.clientes.push({ id: Date.now(), nome, modelo, placa, servicos: [], pago: 0 });
      salvar();
      document.getElementById('cli-nome').value = '';
      document.getElementById('cli-modelo').value = '';
      document.getElementById('cli-placa').value = '';
    }
  };

  window.excluirCliente = (id) => {
    if(confirm("Remover este cliente permanentemente?")) {
      window.dados.clientes = window.dados.clientes.filter(c => c.id !== id);
      salvar();
    }
  };

  // --- SERVI√áOS ---
  window.addServico = (cliId) => {
    const desc = prompt("O que foi feito no caminh√£o?");
    const valor = parseFloat(prompt("Valor cobrado (R$):"));
    if(desc && !isNaN(valor)) {
      const cli = window.dados.clientes.find(c => c.id === cliId);
      if(!cli.servicos) cli.servicos = [];
      cli.servicos.push({ id: Date.now(), desc, valor });
      salvar();
    }
  };

  window.setPagamento = (cliId) => {
    const valor = parseFloat(prompt("Quanto o cliente pagou no total?"));
    if(!isNaN(valor)) {
      window.dados.clientes.find(c => c.id === cliId).pago = valor;
      salvar();
    }
  };

  // --- GASTOS ---
  document.getElementById('addGasBtn').onclick = () => {
    const desc = document.getElementById('gas-desc').value;
    const valor = parseFloat(document.getElementById('gas-valor').value);
    if(desc && valor) {
      window.dados.gastos.push({ id: Date.now(), desc, valor });
      salvar();
      document.getElementById('gas-desc').value = '';
      document.getElementById('gas-valor').value = '';
    }
  };

  window.excluirGasto = (id) => {
    window.dados.gastos = window.dados.gastos.filter(g => g.id !== id);
    salvar();
  };

  // --- RENDERIZA√á√ÉO ---
  function renderizar() {
    let faturamento = 0;
    const listaCli = document.getElementById('lista-clientes');
    listaCli.innerHTML = '';

    window.dados.clientes.forEach(c => {
      let subtotal = (c.servicos || []).reduce((acc, s) => acc + s.valor, 0);
      faturamento += subtotal;
      
      listaCli.innerHTML += `
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border); padding-bottom:10px;">
            <h4 style="color:var(--accent)">${c.nome} <span style="color:var(--text-muted); font-size:12px;">| ${c.modelo} (${c.placa})</span></h4>
            <button onclick="excluirCliente(${c.id})" style="color:var(--red); background:none; border:none; cursor:pointer; font-size:11px;">EXCLUIR</button>
          </div>
          <table style="font-size:13px;">
            ${(c.servicos || []).map(s => `<tr><td>${s.desc}</td><td style="text-align:right">R$ ${s.valor.toFixed(2)}</td></tr>`).join('')}
          </table>
          <div style="margin-top:15px; display:flex; justify-content:space-between; align-items:flex-end;">
            <div>
              <button onclick="addServico(${c.id})" class="btn btn-blue" style="font-size:12px;">+ SERVI√áO</button>
              <button onclick="setPagamento(${c.id})" class="btn btn-green" style="font-size:12px;">PAGAMENTO</button>
              <button onclick="imprimirNota(${c.id})" class="btn btn-blue" style="font-size:12px;">üñ®Ô∏è NOTA</button>
            </div>
            <div style="text-align:right; font-family:'Share Tech Mono';">
              <p style="font-size:12px; color:var(--text-muted)">TOTAL: R$ ${subtotal.toFixed(2)}</p>
              <p style="font-size:12px; color:var(--green)">PAGO: R$ ${c.pago.toFixed(2)}</p>
              <p style="font-size:16px; color:${(subtotal - c.pago) > 0 ? 'var(--red)' : 'var(--green)'}">FALTA: R$ ${(subtotal - c.pago).toFixed(2)}</p>
            </div>
          </div>
        </div>`;
    });

    let gastosTotal = window.dados.gastos.reduce((acc, g) => acc + g.valor, 0);
    document.getElementById('stat-faturamento').innerText = "R$ " + faturamento.toFixed(2);
    document.getElementById('stat-gastos').innerText = "R$ " + gastosTotal.toFixed(2);
    document.getElementById('stat-lucro').innerText = "R$ " + (faturamento - gastosTotal).toFixed(2);

    const corpoG = document.getElementById('corpo-gastos');
    corpoG.innerHTML = window.dados.gastos.map(g => `
      <tr>
        <td>${g.desc}</td>
        <td style="color:var(--red)">R$ ${g.valor.toFixed(2)}</td>
        <td><button onclick="excluirGasto(${g.id})" class="btn btn-red" style="padding:2px 8px;">X</button></td>
      </tr>`).join('');
  }

  window.imprimirNota = (cliId) => {
    const c = window.dados.clientes.find(cli => cli.id === cliId);
    const total = (c.servicos || []).reduce((acc, s) => acc + s.valor, 0);
    const win = window.open('', '', 'width=400,height=600');
    win.document.write(`
      <div style="font-family:sans-serif; width:300px; border:1px solid #000; padding:15px;">
        <h2 style="text-align:center; margin:0;">OFICINA DO ABEL</h2>
        <p style="text-align:center; font-size:10px; border-bottom:1px dashed #000; padding-bottom:10px;">RECIBO DE SERVI√áO</p>
        <p><b>CLIENTE:</b> ${c.nome}</p>
        <p><b>CAMINH√ÉO:</b> ${c.modelo} (${c.placa})</p>
        <div style="border-bottom:1px dashed #000; margin:10px 0;"></div>
        ${(c.servicos || []).map(s => `<p style="font-size:12px; display:flex; justify-content:space-between;"><span>${s.desc}</span> <span>R$ ${s.valor.toFixed(2)}</span></p>`).join('')}
        <div style="border-bottom:1px dashed #000; margin:10px 0;"></div>
        <p style="display:flex; justify-content:space-between;"><b>TOTAL:</b> <b>R$ ${total.toFixed(2)}</b></p>
        <p style="display:flex; justify-content:space-between; color:green;"><span>PAGO:</span> <span>R$ ${c.pago.toFixed(2)}</span></p>
        <p style="display:flex; justify-content:space-between; color:red;"><span>RESTANTE:</span> <span>R$ ${(total - c.pago).toFixed(2)}</span></p>
        <p style="text-align:center; margin-top:30px; font-size:10px;">Emitido em: ${new Date().toLocaleDateString()}</p>
      </div>`);
    win.print();
    win.close();
  };
</script>
</body>
</html>